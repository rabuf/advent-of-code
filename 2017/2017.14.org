#+STARTUP: indent contents
#+OPTIONS: num:nil toc:nil
* Day 14
** Executing this code
If you have a lisp installation, emacs, org-mode, and org-babel
support for lisp installed you can run this by:
1. Starting slime (=M-x slime=)
2. Typing =C-c C-c= in the block [[initialize][initialize]].
3. In the repl type =(in-package :aoc-2017-14)=
4. Typing =C-c C-c= in the block [[answers][answers]]
** Initial stuffs
*** Packages to load
#+NAME: packages
#+BEGIN_SRC lisp :results silent
  (unless (find-package :cl-ppcre)
    (ql:quickload "cl-ppcre"))
  (unless (find-package :iterate)
    (ql:quickload "iterate"))
  (unless (find-package :parseq)
    (ql:quickload "parseq"))
  (unless (find-package :fiveam)
    (ql:quickload "fiveam"))
  (unless (find-package :series)
    (ql:quickload "series"))
  (unless (find-package :cl-permutation)
    (ql:quickload "cl-permutation"))
  (unless (find-package :bordeaux-threads)
    (ql:quickload "bordeaux-threads"))
#+END_SRC
*** Create package for this day
#+NAME: initialize
#+BEGIN_SRC lisp :noweb yes :results silent
  <<packages>>
  (defpackage :aoc-2017-14
    (:use :common-lisp
          :iterate
          :parseq
          :fiveam)
    (:export :problem-a
             :problem-b))
  (in-package :aoc-2017-14)
#+END_SRC
** Input
A parse-free day.
#+NAME: read-input
#+BEGIN_SRC lisp :results silent
#+END_SRC
#+NAME: input
#+BEGIN_SRC lisp :noweb yes :results silent
  (defparameter *input* "stpzcrnm")
#+END_SRC
** Part 1
Reusing knot hash from [[file:2017.10.org][Day 10]].

#+NAME: knot-round
#+BEGIN_SRC lisp :noweb yes :results silent
  (defun knot-reverse (orig pos len)
    (let* ((s (copy-seq orig)))
       (setf (cdr (last s)) s)
       (loop for i from pos
             for j downfrom (+ pos len -1)
             while (< i j)
             do (psetf (nth i s) (nth j s)
                       (nth j s) (nth i s)))
       (subseq s 0 (length orig))))

  (defun knot-round (lengths string &optional (skip 0) (pos 0))
    (loop
       for l in lengths
       with skip = skip
       with pos = pos
       with string = (copy-seq string)
       finally (return (values string skip pos))
       do (setf string (knot-reverse string pos l))
         (incf pos (+ l skip))
         (setf pos (mod pos (length string)))
         (incf skip)))
  (defun part-1 (lengths)
    (let ((hash (knot-round lengths (loop for i from 0 below 256 collect i))))
      (print (* (first hash) (second hash)))))
#+END_SRC
#+NAME: knot-hash
#+BEGIN_SRC lisp :noweb yes :results silent
  (defun knot-dense-hash (sparse)
    (loop
       for i from 0 below 16
       collect
         (let ((vals (subseq sparse (* i 16) (* (1+ i) 16))))
           (reduce (lambda (x y) (boole boole-xor x y)) vals))))
  (defun knot-hash (size input)
    (let ((sparse-hash (loop repeat 64
                          with skip = 0
                          with position = 0
                          with string = (loop for i from 0 below size collect i)
                          with key = (append (map 'list #'char-code input) (list 17 31 73 47 23))
                          finally (return string)
                          do (multiple-value-bind
                                   (st sk pos) (knot-round key string skip position)
                               (setf string st
                                     skip sk
                                     position pos)))))
      (string-downcase (format nil "铂О佝腩雉溴铙瀛栳箬箴狎箦栳箬┅┅＋盼倪右澡翎箅轶麸泔眇豸辈腩雉栳箬弩躞轭翳轭瘐鏖翳篚骀轼镦＂麒弪铛礅弪泔蝌弩痫钿麸翳蝻鳟澡孱泔躅衄轭锰翳轶轶鏖翳届镧泔躅艚翳铛礅弪镦忾趔＋瘟团躞邃篑踽蝈＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘ㄤ彐躅躞邃篑踽蝈ㄩ铕豸祜镳骘骝镯忮祜辈骘栳箬腩雉栳箬驳ㄦ矧磲铋镰立轭瘐椹篚祜玢秕铘疳蝮瀛轭翦珏栳箬候徜轼倍┅┅＋盼倪右＋瘟团痱镡戾憝＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘ㄤ彐躅痱镡戾憝īㄦ矧磲⑿蝻忪屙贝梁狺ア躞邃篑踽蝈轭瘐舄┅＋盼倪右嗅螋物翳狒汜殇孱糸纟麒殂篑踽蝈狎躞邃铄邃麸腩秣栾磲铢珧秕痼镦篑踽蝈翳弪狎瀹澡栳箬犰顼蜷翳轶铒驷篝犷滹瞌汜蝈麸镳糸黹轸蜷玷铒鳟语骚祆汜汨翳蝈篚祠螽骚顼轭麸轸弪狒秭弪遽汨镱犷徜轸麸栳箬翎忪翳狒鏖祆蝈痱弩孱珧殇澡孱骚祆轸弪狒秭弪翳狒珧殇ㄦ蝻翳麸戾骠麸怙趑镯蜷玷舂犷狍箝珙遽汨珧秕铛礅弪骚顼轭麸蝈躞箫礤泔溴骝镯犷遽蜢殄蝻躅洚骚祆泸遽翦珧狃犷躞翳泔溴骝镯圹骈戾翰氨樊辈矧巛勰狴辈嗅螋草莓＋瘟团珧秕瓠泔躅＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘ㄤ彐躅栳箬麸珧狃ㄩ铕豸戾è珧狃磲脲栳箬翎忪濠┅祜镳骘骝镯忮祜辈骘栳箬疳蝮瀛轭翦珏腩雉栳箬驳ㄦ矧磲铋镰立轭瘐椹候徜轼倍滹祜镳骘骝镯忮祜辈麒孱祜玺弩ㄥ痿戛栳箬滹箦翩ㄧ弭栳箬ㄣ镯痨屮戛珧狃瑭扉篝ㄣ镯痨屮戛┅┅祜镳骘泔矧忮轭翳栳箬脲镦珧狃滹祜镳骘镦骟弭轭ЖＣò暴Ｃū癌Ｃò暴Ｃō癌骘铄殓桠矧ǐ镦骟弭泔矧洎麒孱ㄧ弭栳箬铄殓桠矧珧狃铋飑滹瘐箬铄铄殓桠矧ㄧ弭栳箬泔矧珧狃瑭┅珧狃瑭ㄤ彐躅珧秕瓠泔躅ㄧ蜥痂祜镳鏖翳铒溴祜镳骘忮轭翳栳箬脲镦珧狃泔祆邈氅鏖翳骝轭珏鏖翳鲩箝翦磲脲栳箬翎忪濠鏖翳泔躅鏖翳沲蝌孱麒殪铒溴骈钺祆蝈趱蝾泔躅舂滹ㄣ镱ㄦ蜷铉箦翩沲蝌孱痫骝轭珏┅箦翩铒溴蝈盹鲥沲蝌孱铒溴螬箦翩ㄧ弭栳箬沲蝌孱鲩箝翦洎舂祜镳骘铄轭ㄧ弭栳箬沲蝌孱珧狃铋飑滹躅戾篌ㄧ弭栳箬铄鲩箝翦洎瘐箬铄铄骝轭珏┅┅瘐箬痫铒溴螬骝轭珏ㄩ钽泔躅舂┅┅＋盼倪右＋瘟团痱镡戾憝＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘ㄤ彐躅痱镡戾憝īㄦ矧磲⑿蝻忪屙贝潞狺アㄧ蝻躔泔躅ㄨ狍璀麸珧狃轭瘐舄┅┅＋盼倪右絮趑轭轸犰麸珏翳弪＋瘟团篝蝓泗＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘＋盼倪右＋瘟团骢钽糸镱＋屡巧芜右扉箴侯秣邂弩候弩蹯趔箝戾铘技蝈徜轭瘐艟技轭瘐艟技腩雉蝻躅渚技腩雉栳箬揪技躞邃篑踽蝈缶技珧秕瓠泔躅艟＋盼倪右＋瘟团犷篦弪＋屡巧芜右扉箴候弩蹯趔秕麴豸哄痫螋怙翳侯秣邂弩呼犷珈铒技轭轸獒扉寰技篝蝓泗缶技骢钽糸镱缶技轭瘐艟技痱镡戾憝峋技痱镡戾憝饩痱镡戾憝岍痱镡戾憝猢＋盼倪右令篦弪＋遗诱淘雍犷篦弪序镡戾贝梁覆蛋序镡戾贝潞北背藻篝冕箦＋瘟团翦篝汜箦＋屡巧芜右扉箴候弩蹯趔秕麴豸哄痫螋怙翳ㄤ彐篚轸犸惝舶狈贝ㄩ瞽篚轸犸惝舶狈贝翦篝泔躅ㄩ副案躞邃篑踽蝈㈡祚蜱铍┅┅翦篝珧秕ㄩ辈床ㄧ蝻躔泔躅ㄨ狍璀麸珧狃㈡祚蜱铍┅┅蝓睢п镢舶狈贝＋盼倪右藻篝义篚祠＋遗诱淘雍翦篝汜箦阴铑轭翦篝篚轸料卯舶狈贝阴铑轭翦篝孟瘴阴铑轭翦篝且险拈汨邈塍嗅篌ū鞍ォ与轲哎漆殪哎澡秕玷趔龄阴铑弪娱眇戾蝓铑弪＋屡巧芜右徜呼犷珈徜岑溽贝徜鏖翳料貌氨樊尼贝痱镢邃躜尼贝轶忮玳料貌氨樊尼贝阴罨孱尼贝＋盼倪右羽邈殒殂狒轱羽邈殒殂狒轱骘箫祯糸镱＋屡巧芜右徜呼犷珈徜岑犸悴氨翻溽贝徜疳汶徵料貌氨樊尼贝轶痱镢邃躜阴罨孱料貌氨樊尼贝＋盼倪右嗅汶徵弩＋瘟团徜岘疳汶徵弩＋屡巧芜右徜鏖翳俏猎义琊狒躞俏猎义琊狒鏖翳藻暨上躞藻暨上＋盼倪右赠疱犷珏铄蜷泱＋瘟团豉疱蟓犷洵珏铄蜷泱＋屡巧芜右徜＋盼倪右身痨屙孱翎糸镱零趱犰轫痨屙孱翎糸镱怙澌＋屡巧芜右徜呼犷珈徜岑犸悴氨翻溽贝徜技徜岘疳汶徵弩揪疳汶徵怙澌料貌氨樊尼贝轶技豉疱蟓犷洵珏铄蜷泱揪阵邃狍犷屮犴痨镦磲翥栝铉蝈珲灬屮痱弩箝镱痱镢邃躜嗅蝮暹涕铄ㄌ轭疹怙躅溴溥郁蜷铉秕嗅篌黠蜾轶嗅趑弪泔铙翎铘郁蜷铉航ㄜ浍┉ㄜ浍ㄛ岘荸ㄛ岘莴⒒义泔铙翎铘嗅趑弪钸歪翥桢航蔑眇殪濞嗅趑弪瞟歪翥桢歪翥柽硫蜥ò穿嗅篌疹怙躅溴溥郁蜷铉邪斜酗箝糸鲥描狎徙翦蚧忮玳歪翥瑷义燥哂趄轭绋涕铄┈歪翥桢螬邪航深翦珏颛轴祯濞屿殂濞涕铄歪翥桢蟥暴崎蝮衄歪翥桢蟥暴提篝┅斜航深翦珏颛轴祯濞屿殂濞涕铄歪翥桢蟥博崎蝮衄歪翥桢蟥博提篝┅航澎屙孱舁涕铄歪翥桢蟥畅崎蝮舂嗅篌航燥哒钼秕钿邃哂趄轭绋屿殂濞涕铄歪翥桢蟥穿崎蝮衄歪翥桢蟥穿提篝┅航ㄍ轭呦蜻酗骄邪歪呦蜻酗骄斜骄矛骄嗅篌┗孱嗅蝮暹涕铄痱镢邃躜阴轶忮玳絮暨涕铄á龄鲥铘镦蔑溴舶狈尼贝┗絮暨涕铄á澡蝈篚祠骘嗅螋轶深翦珏颛身徵濞癌┗絮暨涕铄á澡蝈篚祠骘嗅螋轶深翦珏颛身徵濞癌┗孱阴罨孱料貌氨樊尼贝＋盼倪右阴翳痱镧蜥深矧溴麸蝓翳轶秕栳鲥麸Ⅳ犷珈澧翳泔溴骈蝮躞轭矫铆铆艚＋屡巧芜右箬屐呼犷珈铒候弩蹯趔秕麴豸哄痫螋怙翳沅徜珙狒磲脲溽贝溽贝＋盼倪右＋遗诱淘雍